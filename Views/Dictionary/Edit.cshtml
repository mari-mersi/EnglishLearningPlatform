@model EnglishLearningPlatform.Models.Word

@{
    ViewData["Title"] = "Редактировать слово";
    ViewData["CurrentPage"] = "words";
}

<!-- Хлебные крошки -->
<div class="breadcrumb mb-4">
    <a asp-action="Index" class="text-violet">Словарь</a>
    <span class="mx-2">/</span>
    <a asp-action="Details" asp-route-id="@Model.Id" class="text-violet">@Model.EnglishWord</a>
    <span class="mx-2">/</span>
    <span class="text-muted">Редактировать</span>
</div>

<!-- Заголовок -->
<div class="create-word-header">
    <h1 class="create-word-title">Редактировать слово</h1>
    <p class="create-word-subtitle">Обновите информацию о слове</p>
</div>

<div class="create-word-container">
    <form asp-action="Edit" class="create-word-form" id="editWordForm">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="Id" />
        <input type="hidden" asp-for="CreatedDate" />

        <!-- Основная информация -->
        <div class="form-section">
            <h3 class="section-title">
                <i class="bi bi-info-circle"></i>Основная информация
            </h3>

            <div class="form-group">
                <label asp-for="EnglishWord" class="form-label">
                    <i class="bi bi-translate"></i>Английское слово *
                </label>
                <input asp-for="EnglishWord" class="form-control" placeholder="Введите слово на английском" />
                <span asp-validation-for="EnglishWord" class="field-validation-error"></span>
            </div>

            <div class="form-group">
                <label asp-for="Translation" class="form-label">
                    <i class="bi bi-chat-square-text"></i>Перевод
                </label>
                <input asp-for="Translation" class="form-control" placeholder="Введите перевод на русский" />
                <small class="form-text">Если оставить пустым, слово будет отмечено как нуждающееся в переводе</small>
            </div>

            <div class="form-group">
                <label asp-for="Transcription" class="form-label">
                    <i class="bi bi-mic"></i>Транскрипция
                </label>
                <input asp-for="Transcription" class="form-control" placeholder="Например: [ˈæpl]" />
            </div>

            <div class="form-group">
                <label asp-for="PartOfSpeech" class="form-label">
                    <i class="bi bi-tag"></i>Часть речи
                </label>
                <select asp-for="PartOfSpeech" class="form-control">
                    <option value="">Выберите часть речи</option>
                    <option value="noun">Существительное</option>
                    <option value="verb">Глагол</option>
                    <option value="adjective">Прилагательное</option>
                    <option value="adverb">Наречие</option>
                    <option value="preposition">Предлог</option>
                    <option value="conjunction">Союз</option>
                    <option value="pronoun">Местоимение</option>
                    <option value="interjection">Междометие</option>
                </select>
            </div>
        </div>

        <!-- Дополнительная информация -->
        <div class="form-section">
            <h3 class="section-title">
                <i class="bi bi-plus-circle"></i>Дополнительная информация
            </h3>

            <div class="form-group">
                <label asp-for="Example" class="form-label">
                    <i class="bi bi-chat-quote"></i>Пример использования
                </label>
                <textarea asp-for="Example" class="form-control" rows="3"
                          placeholder="Пример предложения с этим словом"></textarea>
            </div>

            <div class="form-group">
                <label asp-for="ImageUrl" class="form-label">
                    <i class="bi bi-image"></i>Ссылка на изображение
                </label>
                <input asp-for="ImageUrl" class="form-control"
                       placeholder="https://example.com/image.jpg" />

                <!-- Превью изображения -->
                <div class="image-preview-container">
                    @if (!string.IsNullOrEmpty(Model.ImageUrl)) {
                        <img src="@Model.ImageUrl" class="image-preview"
                             onerror="this.style.display='none'" alt="Предпросмотр изображения" />
                    }
                    else {
                        <img src="" class="image-preview" style="display:none;"
                             alt="Предпросмотр изображения" />
                    }
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">
                    <i class="bi bi-bar-chart"></i>Сложность слова
                </label>
                <input type="hidden" asp-for="DifficultyLevel" id="DifficultyLevel" />
                <div class="difficulty-stars">
                    @for (int i = 1; i <= 5; i++) {
                        <span class="star @(i <= Model.DifficultyLevel ? "active" : "")"
                              data-value="@i">@(i <= Model.DifficultyLevel ? "★" : "☆")</span>
                    }
                </div>
            </div>
        </div>

        <!-- Статус изучения -->
        <div class="form-section">
            <h3 class="section-title">
                <i class="bi bi-check-circle"></i>Статус изучения
            </h3>

            <div class="form-check">
                <input asp-for="IsLearned" class="form-check-input" />
                <label asp-for="IsLearned" class="form-check-label">
                    Отметить как выученное
                </label>
            </div>

            <div class="form-check mt-3">
                <input type="checkbox" class="form-check-input"
                       @(Model.NeedsTranslation ? "checked" : "") disabled />
                <label class="form-check-label">
                    Требуется перевод
                </label>
                <small class="form-text d-block">Автоматически определяется при сохранении</small>
            </div>
        </div>

        <!-- Кнопки действий -->
        <div class="form-actions">
            <button type="submit" class="btn-create">
                <i class="bi bi-check-circle"></i> Сохранить изменения
            </button>
            <a asp-action="Details" asp-route-id="@Model.Id" class="btn-cancel">
                <i class="bi bi-x-circle"></i> Отмена
            </a>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Функциональность звезд рейтинга
            const stars = document.querySelectorAll('.star');
            const difficultyInput = document.querySelector('#DifficultyLevel');

            // Инициализация звезд
            function initializeStars() {
                const currentValue = parseInt(difficultyInput.value) || 1;
                stars.forEach((star, index) => {
                    if (index < currentValue) {
                        star.innerHTML = '★';
                        star.classList.add('active');
                    } else {
                        star.innerHTML = '☆';
                        star.classList.remove('active');
                    }
                });
            }

            initializeStars();

            stars.forEach((star, index) => {
                star.addEventListener('click', () => {
                    // Устанавливаем значение сложности
                    difficultyInput.value = index + 1;

                    // Обновляем визуальное отображение звезд
                    stars.forEach((s, i) => {
                        if (i <= index) {
                            s.innerHTML = '★';
                            s.classList.add('active');
                        } else {
                            s.innerHTML = '☆';
                            s.classList.remove('active');
                        }
                    });
                });

                star.addEventListener('mouseover', () => {
                    stars.forEach((s, i) => {
                        if (i <= index) {
                            s.innerHTML = '★';
                        } else {
                            s.innerHTML = '☆';
                        }
                    });
                });

                star.addEventListener('mouseout', () => {
                    const currentValue = parseInt(difficultyInput.value) || 1;
                    stars.forEach((s, i) => {
                        if (i < currentValue) {
                            s.innerHTML = '★';
                        } else {
                            s.innerHTML = '☆';
                        }
                    });
                });
            });

            // Превью изображения
            const imageUrlInput = document.querySelector('#ImageUrl');
            const imagePreview = document.querySelector('.image-preview');

            imageUrlInput.addEventListener('input', function() {
                if (this.value) {
                    imagePreview.src = this.value;
                    imagePreview.style.display = 'block';
                } else {
                    imagePreview.style.display = 'none';
                }
            });

            // Валидация формы
            const form = document.getElementById('editWordForm');
            form.addEventListener('submit', function(e) {
                let isValid = true;

                // Проверка английского слова
                const englishWordField = document.querySelector('#EnglishWord');
                if (!englishWordField.value.trim()) {
                    isValid = false;
                    englishWordField.classList.add('input-validation-error');

                    if (!englishWordField.nextElementSibling || !englishWordField.nextElementSibling.classList.contains('field-validation-error')) {
                        const errorSpan = document.createElement('span');
                        errorSpan.className = 'field-validation-error';
                        errorSpan.textContent = 'Английское слово обязательно для заполнения';
                        englishWordField.parentNode.insertBefore(errorSpan, englishWordField.nextSibling);
                    }
                } else {
                    englishWordField.classList.remove('input-validation-error');
                    if (englishWordField.nextElementSibling && englishWordField.nextElementSibling.classList.contains('field-validation-error')) {
                        englishWordField.nextElementSibling.remove();
                    }
                }

                if (!isValid) {
                    e.preventDefault();
                    englishWordField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    englishWordField.focus();
                }
            });

            // Автоматическое обновление превью при загрузке страницы
            if (imageUrlInput.value) {
                imagePreview.src = imageUrlInput.value;
                imagePreview.style.display = 'block';
            }
        });
    </script>
}